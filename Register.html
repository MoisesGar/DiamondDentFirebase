<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />

    <title>Registro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Videojuegos & Desarrollo" />
    <meta
      name="description"
      content="Muestra de un formulario de acceso en HTML y CSS"
    />
    <meta name="keywords" content="Formulario Acceso, Formulario de Register" />

    <link
      href="https://fonts.googleapis.com/css?family=Nunito&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Overpass&display=swap"
      rel="stylesheet"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <!-- Link hacia el archivo de estilos css -->
    <link rel="stylesheet" href="./css/Register.css" />
  </head>

  <body>
    <div id="contenedor">
      <div id="central">
        <div id="Register">
          <!-- Logo -->
          <div class="logo">
            <img class="rounded" src="./assets/logo.png" />
          </div>

          <!-- Subtitulo -->
          <div class="titulo">
            <h3>Crear Cuenta</h3>
          </div>
          <br />
          <div>
            <!-- User - Password -->
            <label style="color: white">Usuario</label>
            <input
              type="text"
              class="inputLog"
              name="username"
              id="username"
              placeholder="Usuario"
            />

            <label style="color: white">Correo Electronico</label>
            <input
              type="text"
              class="inputLog"
              id="email"
              placeholder="Email@sorfetch.mx"
              name="email"
            />

            <label style="color: white">Contrase単a</label>
            <input
              type="password"
              class="inputLog"
              id="password"
              placeholder="Contrase単a"
              name="password"
            />

            <!-- Login Button -->
            <input
              class="RegisterButton"
              type="submit"
              title="Registrar"
              id="signUp"
              name="OK"
              value="Registrar"
            />
          </div>

          <br />
          <!-- Don't have an account? -->
          <a class="sesionLink" href="./login.html" >Ya tienes una cuenta?</a>
        </div>
      </div>
    </div>
    
    <script src="JS/register.js"></script>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import cambiarLogin from './JS/register.js';
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js";
      import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";

      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyCHTLjpLCsO-Zsl7my0ZIbO6wJrI61ye5g",
        authDomain: "dimonddent-68852.firebaseapp.com",
        databaseURL: "https://dimonddent-68852-default-rtdb.firebaseio.com",
        projectId: "dimonddent-68852",
        storageBucket: "dimonddent-68852.appspot.com",
        messagingSenderId: "456359697128",
        appId: "1:456359697128:web:7eec13204e979d8792475d",
        measurementId: "G-7FSHC6LKFF",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth();

    signUp.addEventListener('click',(e) =>{
        let email = document.getElementById('email').value;
        let password = document.getElementById('password').value;
        let username = document.getElementById('username').value;

    //Auth
    createUserWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        // Signed in
        const user = userCredential.user;

        set (ref(database, 'users/' + user.uid),{
          username: username,
          email: email
        })
        alert('Registro exitoso');
        cambiarLogin('./login.html');
        // ...
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
        if(!email && !password){alert('Campos vacios')
        }else if (errorMessage == 'Firebase: Error (auth/email-already-in-use).'){
          alert('Email en uso')
        }else if (errorMessage == 'Firebase: Error (auth/invalid-email).' && email){
          alert('Introduzca un email valido')
        }else if (errorMessage =='Firebase: Error (auth/missing-password).' && !password){ 
          alert('Contrase単a Vacia')
        }else if (errorMessage =='Firebase: Password should be at least 6 characters (auth/weak-password).' && password){ 
          alert('Contrase単a muy debil, pruebe con mas de 6 caracteres')
        }else {
          alert(errorMessage);
        }
        // ..
      });
})
    </script>
  </body>
</html>
